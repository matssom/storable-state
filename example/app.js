(()=>{"use strict";class e{constructor(){this.events={}}subscribe(e,t){let s=this;return s.events.hasOwnProperty(e)||(s.events[e]=[]),s.events[e].push(t),()=>s.events[e].push(t)}unsubscribe(e,t){return this.events[e].splice(t,1).length>=1}publish(e,t={}){return this.events.hasOwnProperty(e)?this.events[e].map((e=>e(t))):[]}}class t{constructor(t,s){this.state=t,this.event=new e,this.start=s,this.set=this.set.bind(this),this.update=this.update.bind(this),this.subscribe=this.subscribe.bind(this)}set(e){this.state=e,this.event.publish("STATE_CHANGE",e)}update(e){this.set(e(this.state))}subscribe(e){return this.event.subscribe("STATE_CHANGE",e),1===this.event.events.STATE_CHANGE.length&&this.start&&(this.cleanup=this.start(this.set)),e(this.state),()=>{this.event.unsubscribe("STATE_CHANGE",e)&&0===this.event.events.STATE_CHANGE.length&&this.cleanup&&this.cleanup()}}}class s extends t{constructor(e,t,s){super(t,s),this.key=e,this.retrieve()}save(e){localStorage.setItem(this.key,JSON.stringify(e))}retrieve(){const e=localStorage.getItem(this.key);e&&this.set(JSON.parse(e))}set(e){super.set(e),this.save(e)}update(e){super.update(e)}}const n=(e,t,n)=>((e,t,n)=>new s(e,t,n))(e,t,n),r=n("number",3),i=n("number1",5),c=((e,s)=>{const n=new t,r=[],i=new Map;return e instanceof Array&&e.forEach(((t,s)=>{i.set(s,(t=>{r[s]=t,r.length===e.length&&n.set(((e,t)=>e+t)(...r))})),t.subscribe(i.get(s))})),{subscribe:n.subscribe}})([r,i]);let u;const h=e=>{u=c.subscribe((t=>{e.innerText=t}))};document.querySelector("#increment").addEventListener("click",(()=>r.update((e=>e+1)))),document.querySelector("#decrement").addEventListener("click",(()=>i.update((e=>e-2)))),document.querySelector("#unsubscribe").addEventListener("click",(()=>u())),document.querySelector("#subscribe").addEventListener("click",(()=>h(document.querySelector("#counter")))),h(document.querySelector("#counter"))})();